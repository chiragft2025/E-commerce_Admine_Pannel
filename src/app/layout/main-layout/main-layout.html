<!-- main-layout.component.html -->
<div
  class="app-shell d-flex"
  [class.sidebar-open]="sidebarOpen"
  [attr.data-sidebar-open]="sidebarOpen"
>
  <!-- Sidebar (persistent on md+, offcanvas on sm) -->
  <!-- Offcanvas for small screens -->
  <div class="d-md-none">
    <div
      class="offcanvas offcanvas-start"
      tabindex="-1"
      id="mobileSidebar"
      aria-labelledby="mobileSidebarLabel"
      [class.show]="sidebarOpen"
      [attr.aria-hidden]="!sidebarOpen"
      (click)="toggleSidebar()"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="mobileSidebarLabel">MyApp</h5>
        <button type="button" class="btn-close text-reset" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body p-0">
        <nav class="nav flex-column px-3 py-2" role="navigation" aria-label="Main menu">
          <a routerLink="/home" routerLinkActive="active" class="nav-link" (click)="toggleSidebar()"
            >Dashboard</a
          >
          <a
            routerLink="/categories"
            routerLinkActive="active"
            class="nav-link"
            *appHasPermission="'Category.View'"
            (click)="toggleSidebar()"
            >Categories</a
          >
          <a
            routerLink="/products"
            routerLinkActive="active"
            class="nav-link"
            *appHasPermission="'Product.View'"
            (click)="toggleSidebar()"
            >Products</a
          >
          <a
            routerLink="/customers"
            routerLinkActive="active"
            class="nav-link"
            *appHasPermission="'Customer.View'"
            (click)="toggleSidebar()"
            >Customers</a
          >
          <a
            routerLink="/orders"
            routerLinkActive="active"
            class="nav-link"
            *appHasPermission="'Order.View'"
            (click)="toggleSidebar()"
            >Orders</a
          >
          <a
            routerLink="/users"
            routerLinkActive="active"
            class="nav-link"
            *appHasPermission="'User.View'"
            (click)="toggleSidebar()"
            >Users</a
          >
          <a
            routerLink="/roles"
            routerLinkActive="active"
            class="nav-link"
            *appHasPermission="'Role.View'"
            (click)="toggleSidebar()"
            >Roles</a
          >
        </nav>
      </div>
    </div>
  </div>

  <!-- Persistent sidebar for md+ -->
  <aside class="sidebar d-none d-md-flex flex-column" [attr.aria-hidden]="!sidebarOpen && 'false'">
    <div class="brand p-3 border-bottom">
      <a routerLink="/" class="brand-link d-flex align-items-center text-decoration-none">
        <img src="assets/img/logo.png" alt="logo" height="28" class="me-2" />
        <span class="h6 mb-0">MyApp</span>
      </a>
    </div>
    <nav class="nav flex-column p-3" role="navigation" aria-label="Main menu">
      <a routerLink="/home" routerLinkActive="active" class="nav-link py-2">Dashboard</a>
      <a
        routerLink="/categories"
        routerLinkActive="active"
        class="nav-link py-2"
        *appHasPermission="'Category.View'"
        >Categories</a
      >
      <a
        routerLink="/products"
        routerLinkActive="active"
        class="nav-link py-2"
        *appHasPermission="'Product.View'"
        >Products</a
      >
      <a
        routerLink="/customers"
        routerLinkActive="active"
        class="nav-link py-2"
        *appHasPermission="'Customer.View'"
        >Customers</a
      >
      <a
        routerLink="/orders"
        routerLinkActive="active"
        class="nav-link py-2"
        *appHasPermission="'Order.View'"
        >Orders</a
      >
      <a
        routerLink="/users"
        routerLinkActive="active"
        class="nav-link py-2"
        *appHasPermission="'User.View'"
        >Users</a
      >
      <a
        routerLink="/roles"
        routerLinkActive="active"
        class="nav-link py-2"
        *appHasPermission="'Role.View'"
        >Roles</a
      >
    </nav>
  </aside>

  <!-- Main content -->
  <div class="main flex-grow-1 d-flex flex-column">
    <header class="topbar navbar navbar-expand-md navbar-light bg-white border-bottom">
      <div class="container-fluid">
        <div class="d-flex align-items-center">
          <!-- toggle only visible on sm -->
          <button
            class="btn btn-outline-secondary d-md-none me-2"
            type="button"
            (click)="toggleSidebar()"
            aria-label="Toggle menu"
          >
            <i class="bi bi-list"></i>
          </button>

          <!-- optional collapse for title / breadcrumbs -->
        </div>

        <div class="ms-auto d-flex align-items-center gap-2" (click)="$event.stopPropagation()">
          <!-- User dropdown -->
          <div class="user-dropdown position-relative" [class.show]="userMenuOpen">
            <button
              class="btn btn-sm btn-outline-secondary d-flex align-items-center"
              (click)="toggleUserMenu($event)"
              aria-haspopup="true"
              [attr.aria-expanded]="userMenuOpen"
              id="userMenuButton"
            >
              Hi, {{ userName }}
              <i class="bi bi-caret-down-fill ms-2" aria-hidden="true"></i>
            </button>

            <ul
              class="dropdown-menu dropdown-menu-end shadow-sm"
              [class.show]="userMenuOpen"
              aria-labelledby="userMenuButton"
              style="min-width: 160px; right: 1px"
            >
              <li>
                <a
                  class="dropdown-item"
                  (click)="onProfile()"
                  role="menuitem"
                  href="javascript:void(0)"
                >
                  <i class="bi bi-person me-2"></i>Profile
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a
                  class="dropdown-item"
                  (click)="onChangePassword()"
                  role="menuitem"
                  href="javascript:void(0)"
                >
                  <i class="bi bi-key me-2"></i>Change Password
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <button class="dropdown-item text-danger" (click)="onLogout()" role="menuitem">
                  <i class="bi bi-lock-fill me-2"></i>Logout
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <main class="content flex-grow-1 overflow-auto">
      <div class="container py-4">
        <router-outlet></router-outlet>
      </div>
    </main>

    <footer class="app-footer text-center py-3 border-top bg-white">
      © {{ year }} MyApp — All rights reserved
    </footer>
  </div>
</div>
